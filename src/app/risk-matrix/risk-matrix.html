
<p-toast></p-toast>
<div class="excel-style-container">
  
  <!-- HEADER CON LOGO Y TÃTULO -->
  <div class="excel-header">
    <div class="logo-section">
      <div class="logo-placeholder">LOGO</div>
      <div class="company-name">QUALITY & KNOWLEDGE</div>
    </div>
    <h1 class="excel-title">MATRIZ DE RIESGOS</h1>
  </div>

  <!-- INFORMACIÃ“N DEL PROYECTO -->
  <table class="excel-info-table">
    <tr>
      <td class="info-label">Nombre del Proyecto/Aplicativo:</td>
      <td class="info-value">
        <input 
          type="text" 
          [(ngModel)]="matrixData.nombreProyecto" 
          placeholder="Escribe el nombre del proyecto aquÃ­..."
          (input)="onInputChange()"
          class="project-input" />
      </td>
    </tr>
    <tr>
      <td class="info-label">Clave del Proyecto (si aplica):</td>
      <td class="info-value">
        <input 
          type="text" 
          [(ngModel)]="matrixData.claveProyecto" 
          placeholder="Escribe la clave del proyecto..."
          (input)="onInputChange()"
          class="project-input" />
      </td>
    </tr>
    <tr>
      <td class="info-label">Fecha de creaciÃ³n:</td>
      <td class="info-value"><input type="date" [(ngModel)]="matrixData.fechaCreacion" class="project-input" /></td>
    </tr>
    <tr>
      <td class="info-label">Ãšltima actualizaciÃ³n:</td>
      <td class="info-value"><input type="date" [(ngModel)]="matrixData.ultimaActualizacion" class="project-input" /></td>
    </tr>
  </table>
  
  <!-- Indicador visual de lo que se va a guardar -->
  <div *ngIf="matrixData.nombreProyecto || matrixData.claveProyecto" class="preview-box">
    <strong>ğŸ“ Vista previa de lo que se guardarÃ¡:</strong>
    <div class="preview-content">
      <div *ngIf="matrixData.nombreProyecto" class="preview-item">
        <span class="preview-label">Nombre:</span> 
        <span class="preview-value">"{{ matrixData.nombreProyecto }}"</span>
      </div>
      <div *ngIf="matrixData.claveProyecto" class="preview-item">
        <span class="preview-label">Clave:</span> 
        <span class="preview-value">"{{ matrixData.claveProyecto }}"</span>
      </div>
    </div>
  </div>

  <!-- BOTONES DE EXPORTACIÃ“N -->
  <div class="action-buttons">
    <button class="btn-new" (click)="nuevoProyecto()" title="Limpiar formulario para crear nuevo proyecto">
      <span>â•</span> Nuevo Proyecto
    </button>
    <button class="btn-save" (click)="guardarMatriz()" [disabled]="isSaving">
      <span>ğŸ’¾</span> {{ isSaving ? 'Guardando...' : 'Guardar Proyecto' }}
    </button>
    <button class="btn-excel" (click)="exportExcel()">
      <span>ğŸ“Š</span> Exportar Excel
    </button>
    <button class="btn-pdf" (click)="exportPDF()">
      <span>ğŸ“„</span> Exportar PDF
    </button>
  </div>
  
  <!-- Mensaje de estado del guardado -->
  <div *ngIf="saveMessage" class="save-message" [class.success]="saveMessage.includes('âœ…')" [class.error]="saveMessage.includes('âŒ')">
    {{ saveMessage }}
  </div>

  <!-- CONTROL DE CAMBIOS -->
  <h2 class="section-title">Control de Cambios</h2>
  <table class="excel-control-table">
    <thead>
      <tr>
        <th style="width: 10%;">VersiÃ³n</th>
        <th style="width: 15%;">Fecha</th>
        <th style="width: 40%;">DescripciÃ³n</th>
        <th style="width: 15%;">Autor</th>
        <th style="width: 15%;">AprobÃ³</th>
        <th style="width: 5%;">Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let cambio of matrixData?.controlCambios; let i = index">
        <td><input type="text" [(ngModel)]="cambio.version" placeholder="Ej: 1.0, 2.0, 3.0" /></td>
        <td><input type="date" [(ngModel)]="cambio.fecha" placeholder="dd/mm/yyyy" /></td>
        <td><input type="text" [(ngModel)]="cambio.descripcion" placeholder="Describe los cambios realizados en esta versiÃ³n" /></td>
        <td><input type="text" [(ngModel)]="cambio.autor" placeholder="Nombre completo del autor" /></td>
        <td><input type="text" [(ngModel)]="cambio.aprobo" placeholder="Nombre de quien aprobÃ³" /></td>
        <td class="action-cell">
          <button class="btn-delete-mini" (click)="deleteControlCambio(i)" title="Eliminar">ğŸ—‘ï¸</button>
        </td>
      </tr>
      <!-- Fila de ayuda cuando no hay cambios -->
      <tr *ngIf="!matrixData?.controlCambios || matrixData.controlCambios.length === 0" class="empty-row">
        <td colspan="6" style="text-align: center; padding: 20px; color: #64748b; font-style: italic;">
          No hay cambios registrados. Haz clic en "â• Agregar Fila" para comenzar.
        </td>
      </tr>
    </tbody>
  </table>
  
  <!-- Botones de Control de Cambios -->
  <div class="control-cambios-actions">
    <button class="btn-add-row" (click)="addControlCambio()">
      â• Agregar Fila
    </button>
    <button class="btn-save-control" (click)="guardarTodosCambios()" [disabled]="isSaving">
      <span>ğŸ’¾</span> {{ isSaving ? 'Guardando...' : 'Guardar Cambios' }}
    </button>
  </div>

</div>
